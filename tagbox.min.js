Array.prototype.indexOf||(Array.prototype.indexOf=function(f,C){var k;if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),v=t.length>>>0;if(0===v)return-1;k=+C||0;Infinity===Math.abs(k)&&(k=0);if(k>=v)return-1;for(k=Math.max(0<=k?k:v-Math.abs(k),0);k<v;){if(k in t&&t[k]===f)return k;k++}return-1});
(function(f,C,k){function t(h,d){function b(y){y=new v(y,d);y.b.insertBefore(l);y.b.css("maxWidth",a.d.width());a.a.push(y);g.removeClass("empty");I&&l.val("");m(!0);q.hide();x||l.focus();c()}function w(d,e){d.remove();var b=a.a.indexOf(d);a.a.splice(b,1);0===a.a.length&&g.addClass("empty");d===r&&(r=k);c();m(!0);e&&(-1===e?n(a.a[b-1]):1===e&&n(a.a[b]));s()}function c(){for(var y=[],b=0;b<a.a.length;b+=1)y.push(a.a[b].value);e.val(y.join(d.delimiter));e.trigger("change")}function n(a){r&&r.l();r!==
a?(r=a,a.select()):r=k}function D(){r&&(r.l(),r=k)}function u(){var a=d.searchIn;"string"==typeof a&&(a=[a]);if(f.isArray(a)){for(var b={},e=0;e<a.length;e+=1)b[a[e]]=10;return b}return a}function p(d){for(var b=0;b<a.a.length;b+=1)if(a.a[b].item===d)return!0;return!1}function s(){clearTimeout(J);J=setTimeout(M,20)}function M(){var b=a.items,e=[],m=l.val(),h=u();g.removeClass("invalid");if(a.a.length===d.maxItems)q.hide(),l.removeAttr("placeholder");else if(l.attr("placeholder",K),""!==m||d.autoShow){if(""!==
m){for(var c=0;c<b.length;c+=1){var f={item:b[c],h:N(b[c],m,h)};0<f.h&&(d.allowDuplicates||!p(f.item))&&e.push(f)}e=e.sort(function(a,b){return b.h-a.h});for(c=0;c<e.length;c+=1)e[c]=e[c].item}else for(c=0;c<b.length;c+=1)!d.allowDuplicates&&p(b[c])||e.push(b[c]);q.t(e);q.s(m);q.m(g)}else q.hide()}function m(b){E||a.k==l.val()&&!0!==b||(g.toggleClass("full",a.a.length===d.maxItems),D(),a.k=l.val(),t.text(a.k),l.width(0),l.width(Math.min(g.width()-5,Math.max(g.width()-l.offset().left+g.offset().left-
5,t.width(),1))),q.m(g))}function z(){E||(E=!0,a.d.parent()&&a.d.remove(),a.input.parent()&&a.input.remove(),q.remove(),f(C).unbind("resize."+L),e=g=q=a.input=a.d=a.o=null)}var a=this;a.a=[];var x=!0;document.activeElement===h&&(x=!1);var e=a.input=f(h).hide();a.options=d;var g=a.d=f('<div class="tagbox-wrapper empty" />').click(function(a){var b=f(a.target).closest("input, .tagbox-token, .tagbox-wrapper");b.is(".tagbox-token")?f(a.target).is("a")?w(b.data("token")):n(b.data("token")):D();l.focus()}).insertBefore(a.input);
d.className&&g.addClass(d.className);e.on("invalid",function(b){b.preventDefault();a.d.addClass("invalid")});var K=e.attr("placeholder"),l=f('<input type="text" />').attr({autocomplete:e.attr("autocomplete"),spellcheck:e.attr("spellcheck"),autocapitalize:e.attr("autocapitalize"),placeholder:K}).on("keyup keydown blur update change",m).on("keypress",function(a){if(13===a.keyCode&&l.val())return a.preventDefault(),!1}).on("blur",function(){setTimeout(function(){a.e||q.hide();g.removeClass("focus")},
20);e.triggerHandler("blur")}).on("keydown",function(e){var c,m,g=l[0],h=c=0,f,x;"number"==typeof g.selectionStart&&"number"==typeof g.selectionEnd?(c=g.selectionStart,h=g.selectionEnd):(f=document.selection.createRange())&&f.parentElement()==g&&(x=g.value.length,m=g.value.replace(/\r\n/g,"\n"),h=g.createTextRange(),h.moveToBookmark(f.getBookmark()),g=g.createTextRange(),g.collapse(!1),-1<h.compareEndPoints("StartToEnd",g)?c=h=x:(c=-h.moveStart("character",-x),c+=m.slice(0,c).split("\n").length-1,
-1<h.compareEndPoints("EndToEnd",g)?h=x:(h=-h.moveEnd("character",-x),h+=m.slice(0,h).split("\n").length-1)));m=h;c=l.val().length==c;g=0===m;f=e.keyCode;m=!1;if(e.ctrlKey||e.metaKey)m=!0;if(37===f){if(r)return r===a.a[0]?D():n(a.a[a.a.indexOf(r)-1]),m;g&&a.a.length&&n(a.a[a.a.length-1])}if(39===f){if(r)return r===a.a[a.a.length-1]?D():n(a.a[a.a.indexOf(r)+1]),m;c&&a.a.length&&n(a.a[0])}if(r&&(46===f||8===f))return w(r,8===f?-1:1),m;if(8===f&&g&&a.a.length)return n(a.a[a.a.length-1]),m;if(q.visible){if(38===
f)return q.r(),m;if(40===f)return q.q(),m;if(39==f&&c||13==f||9==f)return q.visible&&((e=q.p())?b(e):d.allowNew&&l.val()&&b(d.createNew(l.val()))),m}else if(l.val()&&13==f)return m;if(a.a.length===d.maxItems&&9!=e.keyCode)return l.val(""),m;setTimeout(s,10)}).on("focus",function(){g.addClass("focus");e.triggerHandler("focus");s()}).appendTo(g);a.focus=function(){l.focus()};var t=f("<span />").appendTo(g).css({position:"absolute",left:-1E5,width:"auto",display:"inline-block",whiteSpace:"nowrap",fontSize:e.css("fontSize"),
fontFamily:e.css("fontFamily"),fontWeight:e.css("fontWeight"),fontVariant:e.css("fontVariant"),letterSpacing:e.css("letterSpacing")}),q=a.o=new O(a,d);q.b.appendTo(d.dropdownContainer);a.items=d.items;if(e.val())for(var F=a.items,G=e.val().split(d.delimiter),H,A=0;A<G.length;A+=1){H=!1;for(var B=0;B<F.length;B+=1)if(F[B][d.valueField]==G[A]){b(F[B]);H=!0;break}!H&&d.allowNew&&b(d.createNew(G[A]))}var I=!0,L=Math.random().toString().slice(2);m(!0);f(C).on("resize."+L,function(){m(!0)});setTimeout(function(){m(!0);
q.b.parent().length||q.b.appendTo(d.dropdownContainer)},500);a.j=b;var r,J,x=!1,E;e.on("tagbox_destroy",z);g.on("tagbox_destroy",z)}function v(h,d){var b=this,w=b.b=f('<div class="tagbox-token"><span></span><a>&times;</a></div>').data("token",b),c=d.tokenFormat;b.value="string"==typeof h?h:h[d.valueField];b.item=h;"string"==typeof c?("string"==typeof h&&(h={value:h}),w.children("span").html(c.replace(/\{\{([^}]*)\}\}/g,function(b,c){return h[c]}))):w.children("span").html(c(h));b.remove=function(){w.data("token",
null);w.remove();b.item=null;b.b=null};b.select=function(){w.addClass("selected")};b.l=function(){w.removeClass("selected")}}function O(h,d){function b(a){n&&f(n).removeClass("selected");s&&s.removeClass("selected");"number"!==typeof a&&(a=u.indexOf(a));if(0<=a){n=u[a];f(n).addClass("selected");clearTimeout(t);var b=n;clearTimeout(m);z=b;m=setTimeout(w,10)}else n=!1,s&&s.addClass("selected");k=a}function w(){var a=f(z),b=a.offset().top-p.offset().top;0>b?p.scrollTop(b+p.scrollTop()):b>p.innerHeight()-
a.outerHeight()&&p.scrollTop(b+p.scrollTop()-p.innerHeight()+a.outerHeight())}var c=this,n,k,u,p=c.b=f('<div class="tagbox-dropdown"><div class="tagbox-list"></div></div>').css({maxHeight:d.maxHeight}).on("mousedown",function(){h.e=!0}).on("mouseup",function(){h.e=!1}).on("mousemove",function(a){a=f(a.target).closest(".tagbox-item");a.length&&b(a[0])}).on("click",".tagbox-item:not(.new-item)",function(a){a=f(a.target).closest(".tagbox-item");a.length&&h.j(a[0].i)}).hide();if(d.allowNew)var s=f('<div class="tagbox-item new-item" />').prependTo(p).on("mousedown",
function(){h.e=!0}).on("mouseup",function(){h.e=!1}).on("click",function(){h.j(d.createNew(c.g))});c.remove=function(){c.b.remove()};c.m=function(a){if(p.parent().length){p.offset();var b=a.offset(),e=p.parent().offset();p.parent().is("body")&&(e={top:0,left:0});p.css({top:b.top-e.top+a.height()+1,left:b.left-e.left,width:a.outerWidth()})}};c.show=function(){p.show();c.visible=!0};c.hide=function(){p.hide();c.visible=!1};c.p=function(){if(n)return n.i};c.q=function(){k===u.length-1?d.allowNew&&c.g||
0===u.length?b(-1):b(0):b(k+1)};c.r=function(){0===k?d.allowNew&&c.g?b(-1):b(u.length-1):(-1===k&&(k=u.length),b(k-1))};var t,m,z;c.s=function(a){s&&((c.g=a)?s.show().text(d.newText.replace(/\{\{txt\}\}/g,a)):s.hide())};c.t=function(a){p.find(".tagbox-list").empty();u=[];var m=p.find(".tagbox-list")[0];if(0<a.length){for(var e=function(b){b=I(a[b],d);m.appendChild(b);u.push(b)},g=0;g<Math.min(50,a.length,d.maxListItems);)e(g++);50===g&&setTimeout(function(){for(;g<Math.min(a.length,d.maxListItems);)e(g++)},
20);b(0)}else d.allowNew||f('<div class="tagbox-item empty"/>').text(d.emptyText).appendTo(p.find(".tagbox-list")),b(-1);c.show()}}function I(f,d){var b=document.createElement("div");b.className="tagbox-item"+(d.itemClass?" "+d.itemClass:"");b.i=f;var k=d.rowFormat;"string"==typeof k?("string"==typeof f&&(f={value:f}),b.innerHTML=k.replace(/\{\{([^}]*)\}\}/g,function(b,d){return f[d]})):b.innerHTML=k(f);return b}var N=function(){function f(b){return b.replace(/[\[\]\{\}\(\)\^\$\.\*\+\|]/g,function(b){return"\\"+
b})}function d(b){return/[a-z]/.test(b)?n:/[A-Z]/.test(b)?c:/[0-9]/.test(b)?t:/[\/\-_\.]/.test(b)?u:p}function b(b,c,a){b=d(b);return s[b][d(c)]+0.4*s[b][d(a)]}function k(c,d,a){if(0===d.length)return 100*a/c.length;if(0===c.length||!c.slice(a).match(RegExp(("^.*"+f(d.split("").join("~~K~~"))+".*$").split("~~K~~").join(".*"),"i")))return-1;for(var p=d.charAt(0),e=-1,g;a<c.length;a+=1)if(c.charAt(a).toLowerCase()===p.toLowerCase()){var n=k(c.substr(a),d.slice(1),1);if(-1!=n){var l=400/Math.max(1,a);
0===c.substr(a).toLowerCase().indexOf(d.toLowerCase())&&(l+=3*d.length*d.length);l+=b(c.charAt(a),0===a?"/":c.charAt(a-1),a===c.length-1?"/":c.charAt(a+1));l+=n;if(l>e)for(e=l,g=[a],n=n.f||[],l=0;l<n.length;l+=1)g.push(n[l]+a)}}return{c:e,valueOf:function(){return this.c},f:g}}var c=0,n=1,t=2,u=3,p=4,s=[[0,240,120,240,220],[20,0,20,120,120],[140,140,0,140,140],[120,120,120,0,120],[120,120,120,160,0]],v=function(b,c){var a=RegExp("["+b+"]","g"),d={},e;lookup=function(a){return d[a]||a};for(e=0;e<b.length;e+=
1)d[b.charAt(e)]=c.charAt(e);return function(b){return b.replace(a,lookup)}}("\u00e0\u00e1\u00e2\u00e3\u00e4\u00e7\u00e8\u00e9\u00ea\u00eb\u00ec\u00ed\u00ee\u00ef\u00f1\u00f2\u00f3\u00f4\u00f5\u00f6\u00f9\u00fa\u00fb\u00fc\u00fd\u00ff\u00c0\u00c1\u00c2\u00c3\u00c4\u00c7\u00c8\u00c9\u00ca\u00cb\u00cc\u00cd\u00ce\u00cf\u00d1\u00d2\u00d3\u00d4\u00d5\u00d6\u00d9\u00da\u00db\u00dc\u00dd","aaaaaceeeeiiiinooooouuuuyyAAAAACEEEEIIIINOOOOOUUUUY");return function(b,c,a){if("string"==typeof b)return k(v(b),v(c),
0);var d={c:0,valueOf:function(){return this.c},f:{}},e;for(e in a)if(a.hasOwnProperty(e)&&b.hasOwnProperty(e)){var f=k(v(b[e]),v(c),0);d.c+=a[e]*f;d.f[e]=0<f?f.f:[]}return d}}();f.n=function(h){return function(d){var b,k,c;for(c=0;null!=(k=d[c]);c++)try{(b=f.u(k,"events"))&&b.tagbox_destroy&&f(k).triggerHandler("tagbox_destroy")}catch(n){}h(d)}}(f.n);f.fn.tagbox=function(h){var d=f.extend({},{maxHeight:200,maxListItems:20,rowFormat:"{{value}}",tokenFormat:"{{value}}",valueField:"value",searchIn:["value"],
delimiter:",",allowDuplicates:!1,createNew:function(b){return{value:b}},allowNew:!1,newText:"{{txt}}",emptyText:"Not Found",dropdownContainer:"body",maxItems:-1,autoShow:!1},h);return this.each(function(){if(!f(this).data("tagbox")){var b=new t(this,d);f(this).data("tagbox",b)}})}})(jQuery,window);
